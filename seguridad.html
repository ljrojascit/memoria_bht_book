<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Memoria de Cálculo MBHT - 4&nbsp; Dimensión Seguridad</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./accesibilidad.html" rel="next">
<link href="./ambiental.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./seguridad.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimensión Seguridad</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Memoria de Cálculo MBHT</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./socioeconomico.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Dimensión Socioeconómica</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ambiental.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dimensión Ambiental</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./seguridad.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimensión Seguridad</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accesibilidad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dimensión Accesibilidad</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./consolidacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Consolidación de Dimensiones</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#resumen" id="toc-resumen" class="nav-link active" data-scroll-target="#resumen"><span class="header-section-number">4.1</span> Resumen</a></li>
  <li><a href="#insumos" id="toc-insumos" class="nav-link" data-scroll-target="#insumos"><span class="header-section-number">4.2</span> Insumos</a></li>
  <li><a href="#proceso" id="toc-proceso" class="nav-link" data-scroll-target="#proceso"><span class="header-section-number">4.3</span> Proceso</a>
  <ul class="collapse">
  <li><a href="#proceso-de-kernel-de-densidad-puntos-a-raster." id="toc-proceso-de-kernel-de-densidad-puntos-a-raster." class="nav-link" data-scroll-target="#proceso-de-kernel-de-densidad-puntos-a-raster."><span class="header-section-number">4.3.1</span> Proceso de Kernel de densidad, puntos a raster.</a></li>
  <li><a href="#asignación-a-manzanas" id="toc-asignación-a-manzanas" class="nav-link" data-scroll-target="#asignación-a-manzanas"><span class="header-section-number">4.3.2</span> Asignación a Manzanas</a></li>
  <li><a href="#normalización-e-invertir." id="toc-normalización-e-invertir." class="nav-link" data-scroll-target="#normalización-e-invertir."><span class="header-section-number">4.3.3</span> Normalización e Invertir.</a></li>
  </ul></li>
  <li><a href="#aplicación" id="toc-aplicación" class="nav-link" data-scroll-target="#aplicación"><span class="header-section-number">4.4</span> Aplicación</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimensión Seguridad</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="img/ibtseguridad.jpg" class="img-fluid"></p>
<section id="resumen" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="resumen"><span class="header-section-number">4.1</span> Resumen</h2>
<p>El indicador de seguridad (ISEG) es un índice normalizado que busca mostrar el nivel de seguridad de cada manzana, representando con 1 las manzanas que cuentan con el mayor nivel de seguridad y con 0 las de menor nivel de seguridad.</p>
<p>Esto es relavante para el bienestar de las personas, entendiendo el efecto que ejerce la violencia en el desarrollo y el ejercicio de la libertad individual, además de su impacto en la confianza hacia otras personas, vecinos e instituciones. Limitando la eficacia y extensión de las redes de apoyo <span class="citation" data-cites="social2016metodologia socialNuevaMetodologiaMedicion2015">(<a href="references.html#ref-social2016metodologia" role="doc-biblioref">Social 2016</a>, <a href="references.html#ref-socialNuevaMetodologiaMedicion2015" role="doc-biblioref">2015</a>)</span></p>
<p>Operativamente este indicador se construye a partir de la densidad kernel de la ocurrencia de delitos por cada territorio, lo que significa que para cada región se estima una función de densidad de probabilidad de los delitos. Esto representa una medida de <em>concentración relativa</em> de hechos delictuales. Una vez calculada la densidad, se pasa la información a raster y se le asigna a cada manzana el valor del raster que está en el centroide.</p>
<p>El indicador de seguridad se calcula para 4 categorías de delitos: <strong>Leves personas</strong>, <strong>Graves personas</strong>, <strong>Leves propiedad</strong> y <strong>Graves propiedad</strong>.</p>
</section>
<section id="insumos" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="insumos"><span class="header-section-number">4.2</span> Insumos</h2>
<p>El trabajo de estos indicadores usa el tipo de dato punto, el cual representa la ocurrencia y ubicación de un elemento o hecho. Es así que el principal insumo es la ocurrencia de delitos en el territorio, lo que se representa por puntos. Estos deben ser anonimizados, lo que implica agrupar puntos en una grilla regular de 100 metros.</p>
<p>Por otro lado, es necesario categorizar los delitos, lo que se consigue mediante el uso de un diccionario que asocia la categoría del delito con una clasificación que diferencia entre el objeto de delito (personas o propiedad) y el nivel de gravedad de este (leve o grave). Un ejemplo de las categorías usadas se muestra a continuación:</p>
<p><img src="images/diccionario.PNG" class="img-fluid"></p>
</section>
<section id="proceso" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="proceso"><span class="header-section-number">4.3</span> Proceso</h2>
<p>El proceso en general considera un proceso de entrada donde se toma la ocurrencia de delitos y se le asigna la categoria a partir del diccionario mencionado.</p>
<p><img src="img/diagrama-seguridad.PNG" class="img-fluid"></p>
<p>Luego, estos puntos se analizan mediante un proceso de kernel de densidad, que genera <em>hotspots</em> de agrupación de delitos en formato raster.</p>
<p>Luego este resultado debe ser asignado a las manzanas censales, mediante el promedio de valores de la grilla de densidad dentro de cada manzana.</p>
<p>Finalmente el resultado a nivel de manzana se normaliza para que se exprese entre los valores de 0 a 1, y se invierte para que el mas alto valor implique la ausencia de ocurrencia de delitos.</p>
<section id="proceso-de-kernel-de-densidad-puntos-a-raster." class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="proceso-de-kernel-de-densidad-puntos-a-raster."><span class="header-section-number">4.3.1</span> Proceso de Kernel de densidad, puntos a raster.</h3>
<p>Para calcular la densidad de kernel se crea un objeto de clase <code>ppp</code> que representa un patron de puntos en un plano de dos dimensiones.</p>
<p>Para crear este objeto, necesitamos una ventana de trabajo que contará con las dimensiones del límite urbano más un margen de 500 metros. Además, el límite urbano se pasa a raster con un buffer también de 500 metros. En la aplicación de ejemplo se demuestra este proceso en una comuna, por lo que a modo de ilustración se usan 100 metros en vez de 500.</p>
<p>Una vez hecho lo anterior, se calcula la densidad kernel con la función <code>density</code> del paquete <code>stats</code>. Conceptualmente, lo que hace esta función es calcular la densidad de puntos (delitos) por unidad de área.</p>
<p>Se ajusta una superficie curva uniforme sobre cada punto, y en el centro, donde está el punto, el valor del raster es más alto, y a medida que nos alejamos del centro el valor del raster disminuye.</p>
<p>Luego, la densidad kernel que fue calculada en la ventana de trabajo se pasa a raster con la proyección UTM 19 sur WGS84.</p>
<p>Finalmente, cada raster posee un valor que corresponde a la densidad de delitos que hay en esa celda.</p>
</section>
<section id="asignación-a-manzanas" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="asignación-a-manzanas"><span class="header-section-number">4.3.2</span> Asignación a Manzanas</h3>
<p>Para imputar los valores de los raster a las manzanas, se considera el valor que contiene el raster que está al centro de la manzana (centroide).</p>
<p>Una cosa importante a notar es que la densidad de kernel asigna un valor más alto cuando estamos en presencia de la máxima cantidad de delitos por área.</p>
</section>
<section id="normalización-e-invertir." class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="normalización-e-invertir."><span class="header-section-number">4.3.3</span> Normalización e Invertir.</h3>
<p>El indicador ISEG asigna un mayor valor a las manzanas con mayor seguridad (menor cantidad de delitos) y un menor valor a las manzanas con menor seguridad (mayor cantidad de delitos).</p>
<p>Por lo que, una vez imputado el valor del centroide a cada manzana, se invierten los valores de la densidad kernel para lograr obtener la lectura del indicador ISEG, el cual al ser un índice normalizado contiene valores entre 0 y 1, donde 1 significa la mayor seguridad dentro de la muestra.</p>
</section>
</section>
<section id="aplicación" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="aplicación"><span class="header-section-number">4.4</span> Aplicación</h2>
<p>A continuación se demuestra el flujo de trabajo mencionado para la comuna de Las Condes. Comenzamos por configurar el entorno de trabajo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># librerias</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgeos)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exactextractr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"rgdal_show_exportToProj4_warnings"</span><span class="ot">=</span><span class="st">"none"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Definir proyeccion</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>crs_utm <span class="ot">&lt;-</span> <span class="st">"+proj=utm +zone=19 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>crs_ll <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Luego cargamos los datos de entrada: las manzanas y la ubicación de delitos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># puntos con ocurrencia de delitos</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>violencia <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/casos_violencia.rds"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># polígono de manzanas censales</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>mzs       <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/manzanas_lc.rds"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># consolida polígono comunal a partir de manzanas</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>lu_reg    <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mzs) <span class="sc">%&gt;%</span> <span class="fu">st_buffer</span>(<span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> <span class="fu">st_buffer</span>(<span class="sc">-</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">as_Spatial</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación se presentan las manzanas de la comuna:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mzs) <span class="sc">+</span> <span class="fu">tm_borders</span>() <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">title=</span><span class="st">"Manzanas Urbanas Las Condes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seguridad_files/figure-html/seg-poly-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En esta demostración los puntos se refieren a hechos de violencia y ya se encuentran anonimizados. El flujo busca mostrar como se tratan estos datos en los distintos indicadores de la dimensión. A continuación se demuestra la ubicación de estos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Generar puntos espaciales</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>violencia <span class="ot">=</span> <span class="fu">SpatialPointsDataFrame</span>(<span class="at">coords=</span>violencia[,<span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>)], <span class="at">data =</span> violencia, <span class="at">proj4string =</span> <span class="fu">CRS</span>(crs_utm))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Visualizar</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(violencia, <span class="at">main =</span> <span class="st">"Delitos violentos en la comuna de Las Condes"</span>, <span class="at">col =</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seguridad_files/figure-html/seg-pts-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A partir de esto generamos el kernel de densidad. Esto se consigue primero generando una ventana de obesrvación y transformando los puntos al tipo de objeto patrón de puntos representado por <code>ppp</code>. Como se mencionó anteriormente, al ser una ilustración comunal del proceso, se trabaja con una resolución de 100 metros en vez de 500. En la aplicación oficial, se usa una resolución de 500 metros.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>grid_spacing <span class="ot">=</span> <span class="dv">100</span> <span class="co"># aplicacion comunal, para aplicacion regional usar 500 metros</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ext <span class="ot">&lt;-</span> <span class="fu">extent</span>(violencia)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>x_min <span class="ot">&lt;-</span> ext[<span class="dv">1</span>] <span class="sc">-</span> grid_spacing</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>x_max <span class="ot">&lt;-</span> ext[<span class="dv">2</span>] <span class="sc">+</span> grid_spacing</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>y_min <span class="ot">&lt;-</span> ext[<span class="dv">3</span>] <span class="sc">-</span> grid_spacing</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>y_max <span class="ot">&lt;-</span> ext[<span class="dv">4</span>] <span class="sc">+</span> grid_spacing</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">c</span>(x_min,x_max, y_min, y_max)) <span class="co"># ventana que define espacio de trabajo</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> fasterize<span class="sc">::</span><span class="fu">raster</span>(lu_reg,<span class="at">res=</span>grid_spacing)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># base de puntos</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">coordinates</span>(violencia)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ppp</span>(pts[,<span class="dv">1</span>], pts[,<span class="dv">2</span>], <span class="at">window =</span> w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con el patrón de puntos y la ventana de observación se calcula la densidad:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculo de Hotspots con radios mas y menos extensos de agregacion (adjust*bandwidth)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>del_hotspots_1 <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">density</span>(p, <span class="at">adjust=</span>.<span class="dv">25</span>) <span class="co"># parametro de radio de kernel</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(del_hotspots_1, <span class="at">main=</span><span class="st">'Densidad de Delitos Violentos 0.25'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seguridad_files/figure-html/seg-density-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A partir de la densidad es necesario tratar el dato para trabajarlo en formato <code>raster</code> y reproyectarlo al área de trabajo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformar a Raster ----------------------------------------------------</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>kde_del <span class="ot">&lt;-</span> <span class="fu">raster</span>(del_hotspots_1)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(kde_del)<span class="ot">=</span><span class="fu">proj4string</span>(violencia) <span class="co"># Asignar CRS # corregido</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>kde_del <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">mask</span>(kde_del, lu_reg) <span class="co"># Cortar por contorno URBANO</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># kde_del &lt;- kde_del * factor_mult</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>kde_del[kde_del <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reasamplear ------------------------------------------------</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>kde_del <span class="ot">&lt;-</span>  <span class="fu">resample</span>(kde_del, r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El resultado de esto se muestra a continuación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kde_del, <span class="at">main =</span> <span class="st">"Raster de Densidad de Delitos en Las Condes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seguridad_files/figure-html/seg-plot-mask-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ya con la información preparada en formato <code>raster</code> solo resta asignar estos valores a los polígonos de interés, en este caso las manzanas. En este caso asignaremos el valor del raster al polígono mediante la intersección del centroide de la manzana en el raster de valores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>values_mz <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(kde_del, <span class="fu">st_centroid</span>(<span class="fu">st_as_sf</span>(mzs)))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>normalize_minmax <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T)) <span class="sc">/</span> (<span class="fu">max</span>(x, <span class="at">na.rm =</span> T)<span class="sc">-</span><span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>mzs_res <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mzs) <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">indicador =</span> values_mz) <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">indicador =</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">round</span>(<span class="fu">normalize_minmax</span>(indicador),<span class="dv">4</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El resultado de esto se presenta a continuación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mzs_res <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"indicador"</span>, <span class="at">style=</span><span class="st">"jenks"</span>, <span class="at">palette=</span><span class="st">"RdYlGn"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seguridad_files/figure-html/seg-viz-ind-1.png" class="img-fluid" width="672"></p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-socialNuevaMetodologiaMedicion2015" class="csl-entry" role="listitem">
Social, Observatorio. 2015. <span>“Nueva <span>Metodología</span> de <span>Medición</span> de La <span>Pobreza</span> Por <span>Ingresos</span> y <span>Multidimensional</span>.”</span> <span>Observatorio Social. Serie Docuementos Metodologicos N° 28</span>.
</div>
<div id="ref-social2016metodologia" class="csl-entry" role="listitem">
———. 2016. <span>“Metodología de Medición de Pobreza Multidimensional Con Entorno y Redes.”</span> <em>Serie de Documentos Metodológicos Casen</em>, no. 32: 67.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ambiental.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dimensión Ambiental</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./accesibilidad.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dimensión Accesibilidad</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>