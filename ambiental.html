<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Memoria de Cálculo MBHT - 3&nbsp; Dimensión Ambiental</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./seguridad.html" rel="next">
<link href="./socioeconomico.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ambiental.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dimensión Ambiental</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Memoria de Cálculo MBHT</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./socioeconomico.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Dimensión Socioeconómica</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ambiental.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dimensión Ambiental</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./seguridad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimensión Seguridad</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accesibilidad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dimensión Accesibilidad</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./consolidacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Consolidación de Dimensiones</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#resumen" id="toc-resumen" class="nav-link active" data-scroll-target="#resumen"><span class="header-section-number">3.1</span> Resumen</a></li>
  <li><a href="#insumos" id="toc-insumos" class="nav-link" data-scroll-target="#insumos"><span class="header-section-number">3.2</span> Insumos</a>
  <ul class="collapse">
  <li><a href="#landsat-8" id="toc-landsat-8" class="nav-link" data-scroll-target="#landsat-8"><span class="header-section-number">3.2.1</span> Landsat 8</a></li>
  <li><a href="#dem" id="toc-dem" class="nav-link" data-scroll-target="#dem"><span class="header-section-number">3.2.2</span> DEM</a></li>
  <li><a href="#vapor-de-agua" id="toc-vapor-de-agua" class="nav-link" data-scroll-target="#vapor-de-agua"><span class="header-section-number">3.2.3</span> Vapor de Agua</a></li>
  <li><a href="#area-de-estudio" id="toc-area-de-estudio" class="nav-link" data-scroll-target="#area-de-estudio"><span class="header-section-number">3.2.4</span> Area de Estudio</a></li>
  </ul></li>
  <li><a href="#proceso" id="toc-proceso" class="nav-link" data-scroll-target="#proceso"><span class="header-section-number">3.3</span> Proceso</a>
  <ul class="collapse">
  <li><a href="#diagramas" id="toc-diagramas" class="nav-link" data-scroll-target="#diagramas"><span class="header-section-number">3.3.1</span> Diagramas</a></li>
  <li><a href="#preproceso" id="toc-preproceso" class="nav-link" data-scroll-target="#preproceso"><span class="header-section-number">3.3.2</span> Preproceso</a></li>
  <li><a href="#cálculo-de-indices" id="toc-cálculo-de-indices" class="nav-link" data-scroll-target="#cálculo-de-indices"><span class="header-section-number">3.3.3</span> Cálculo de Indices</a></li>
  <li><a href="#cálculo-de-indicadores" id="toc-cálculo-de-indicadores" class="nav-link" data-scroll-target="#cálculo-de-indicadores"><span class="header-section-number">3.3.4</span> Cálculo de Indicadores</a></li>
  </ul></li>
  <li><a href="#aplicación" id="toc-aplicación" class="nav-link" data-scroll-target="#aplicación"><span class="header-section-number">3.4</span> Aplicación</a>
  <ul class="collapse">
  <li><a href="#icv-1" id="toc-icv-1" class="nav-link" data-scroll-target="#icv-1"><span class="header-section-number">3.4.1</span> ICV</a></li>
  <li><a href="#iata-1" id="toc-iata-1" class="nav-link" data-scroll-target="#iata-1"><span class="header-section-number">3.4.2</span> IATA</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Dimensión Ambiental</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="img/02_ambiental.png" class="img-fluid" style="width:85.0%"></p>
<section id="resumen" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="resumen"><span class="header-section-number">3.1</span> Resumen</h2>
<p>La Dimensión Ambiental tiene por objetivo medir el confort ambiental en un determinado entorno, para lo cual se considera la amplitud térmica y cobertura vegetal de cada manzana urbana y rural. Los datos utilizados para su construcción son imágenes satelitales obtenidas a partir de las plataformas Landsat, Aqua y Terra.</p>
<p>Los indicadores que lo componen son:</p>
<ul>
<li><p><strong>ICV</strong> : Índice de Cobertura Vegetal.</p></li>
<li><p><strong>IATA</strong>: Índice de Amplitud Térmica.</p></li>
</ul>
<p>Con esto se busca representar el hecho de que existen territorios cuyo confort ambiental es más adecuado para la población, con mayor cobertura de áreas verdes y vegetación más frondoza. Además de diferencias de temperaturas entre invierno y verano menos pronunciadas, facilitando el disfrute de la población.</p>
</section>
<section id="insumos" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="insumos"><span class="header-section-number">3.2</span> Insumos</h2>
<p>Para calcular los indicadores que componen esta dimensión es necesario el uso de imágenes satelitales. Estas se encuentran disponibles en plataformas de acceso público pero requieren de ciertos preprocesos de corrección antes de ser usadas para calcular índices, los cuales se explicarán en el próximo apartado.</p>
<p>El proceso de datos satelitales se realiza mediante el uso del tipo de dato <strong>raster</strong>, el cual representa información en el territorio mediante celdas de tamaño uniforme de resolución fija, cada cual tiene asociado un vector de información particular. Este tipo de dato es complementario al dato de tipo polígono, siendo el dato raster una cuadradilla sobre la cual pueden representarse distintas divisiones administrativas mediante polígonos.</p>
<p><img src="img/tst-ñuble.jpg" class="img-fluid"></p>
<p>Como se mencionó, estos indicadores usan datos satelitales, los cuales se relacionan con la disciplina de <strong>percepción remota</strong> la cual entrega un amplio conjunto de conocimientos y tecnologías utilizadas para observación, análisis, la interpretación de fenómenos en el territorio. La percepción remota nos permite efectuar observaciones y mediciones de la superficie terrestre mediante dispositivos remotos instalados sobre plataformas como satélites, aviones y actualmente hasta en drones. Los sensores instalados en estas plataformas miden una gran variedad de datos como radiaciones electromagnéticas, espectro electromagnético, perturbaciones atmosféricas, firmas espectrales y captura de imágenes, entre otros.</p>
<p><img src="img/satelites.jpg" class="img-fluid"></p>
<p>Es así que los satélites llevan instrumentos o sensores que miden la radiación electromagnética proveniente del sistema tierra - atmósfera. La intensidad de la radiación reflejada y emitida al espacio es influenciada por las condiciones en la superficie y la atmósfera.</p>
<p>Estas mediciones se expresan en el espectro electromagnético, el cual es un conjunto de frecuencias o longitudes de onda en los que se organiza la radiación electromagnética. Abarca las radiaciones entre los rayos gamma y las ondas de radio.</p>
<p>En nuestro caso usaremos datos de satélites específicos, y bandas particulares, las cuales representan un rango del espectro electromagnético. Con esta información se construyen índices normalizados los cuales se asocian empíricamente a distintos elementos, como vegetación, suelo construido o presencia de cuerpos de agua.</p>
<p><img src="img/espectro_sat.png" class="img-fluid"></p>
<p>Los distintos insumos para el cálculo son:</p>
<ul>
<li><p>Imágenes de Landsat 8</p></li>
<li><p>DEM: Modelo de Elevación Digital</p></li>
<li><p>Vapor de Agua</p></li>
<li><p>Área de Estudio</p></li>
</ul>
<section id="landsat-8" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="landsat-8"><span class="header-section-number">3.2.1</span> Landsat 8</h3>
<p>El insumo principal para estos indicadores es la imaginería satelital de los sensores <strong>OLI</strong> y <strong>TIRS</strong> de la plataforma satelital Landsat 8 del United States Geological Survey (USGS).</p>
<p>Este satélite posee una cobertura global de imágenes satelitales a una resolución de 30 metros, y revisita un mismo punto sobre la superficie de la tierra cada 16 días. Cada escena satelital cubre una superficie terrestre de 180 km por 190 km aproximadamente.</p>
<p>Como ejemplo, se muestra el proceso de la región de Ñuble. Debido a la extensión de esta, fueron necesarias 3 escenas satelitales para cubrirla por completo, tal como se aprecia en la imagen.</p>
<p><img src="img/lansdsat-ñuble.jpg" class="img-fluid"></p>
</section>
<section id="dem" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="dem"><span class="header-section-number">3.2.2</span> DEM</h3>
<p>Junto con las imágenes satelitales, se necesita una cobertura que permita realizar las correcciones topográficas de las imágenes satelitales. El Modelo Digital de Elevación, o DEM en sus siglas en inglés, permite el cálculo de las coberturas de pendientes y orientación de laderas, necesarias para el proceso de corrección topográfica.</p>
<p>El DEM utilizado en ese caso corresponde al generado por la plataforma <a href="https://asterweb.jpl.nasa.gov/gdem.asp">ASTER GDEM</a>, con una resolución de 30 metros, el cual tiene una cobertura global. En ese caso, se utiliza un DEM que cubre la totalidad de la región de Ñuble.</p>
<p><img src="img/demñuble.jpg" class="img-fluid"><br>
</p>
</section>
<section id="vapor-de-agua" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="vapor-de-agua"><span class="header-section-number">3.2.3</span> Vapor de Agua</h3>
<p>Para el cálculo de la temperatura superficial, es necesario también el producto de vapor de agua atmosférico del sensor MODIS, el cual se descarga desde la plataforma web <a href="https://ladsweb.modaps.eosdis.nasa.gov/">LAADS DAAC</a> de la NASA. Este insumo se descarga para la misma fecha de las imágenes satelitales, y deben coincidir espacialmente entre sí. A continuación se aprecia una de las imágenes de vapor de agua.</p>
<p><img src="img/water-ñuble.jpg" class="img-fluid"></p>
<p>El Vapor de Agua de MODIS posee una resolución espectral de 1 kilómetro, y revisita un mismo punto de la superficie terrestre entre 3 a 4 veces por día.</p>
</section>
<section id="area-de-estudio" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="area-de-estudio"><span class="header-section-number">3.2.4</span> Area de Estudio</h3>
<p>El área de estudio se define a partir de la unidad administrativa del área de interés, en este caso los límites de la Región de Ñuble. Luego, se generan polígonos de áreas de estudio independientes para cada escena satelital, identificadas por sus coordenadas Path y Row.</p>
<p>Estos polígonos deben coincidir con la extensión de todos los insumos satelitales, para evitar la contaminación de valores nulos o NoData. Las áreas de estudio consideradas para la región del Ñuble son las que se aprecian en la imagen.</p>
<p><img src="img/area-estudio-ñuble.jpg" class="img-fluid"></p>
<p>Este paso corresponde al inicio del trabajo con las imágenes satelitales. Son seleccionadas las bandas espectrales que se utilizarán y luego son integradas en un Brick. Posteriormente, este Brick es recortado mediante un Crop con el archivo de área de estudio correspondiente a la escena satelital. Este proceso se repite para cada una de las imágenes satelitales multiespectrales</p>
</section>
</section>
<section id="proceso" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="proceso"><span class="header-section-number">3.3</span> Proceso</h2>
<section id="diagramas" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="diagramas"><span class="header-section-number">3.3.1</span> Diagramas</h3>
<p>El proceso general comprende la carga de los insumos de entrada, luego la aplicación de preprocesos de corrección de imagenes, los cuales comprenden la corrección topográfica, y de reflectancia. Luego de esto se calculan índices en el la etapa de procesamiento, los cuales son usadas para calcular los indicadores de salida.</p>
<p><img src="img/diagrama-ambiental.PNG" class="img-fluid"></p>
</section>
<section id="preproceso" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="preproceso"><span class="header-section-number">3.3.2</span> Preproceso</h3>
<section id="extraccion-por-area-de-estudio" class="level4" data-number="3.3.2.1">
<h4 data-number="3.3.2.1" class="anchored" data-anchor-id="extraccion-por-area-de-estudio"><span class="header-section-number">3.3.2.1</span> Extraccion por area de estudio</h4>
<p>Este paso corresponde al inicio del trabajo con las imágenes satelitales. Son seleccionadas las bandas espectrales que se utilizarán y luego son integradas en un Brick. Posteriormente, este Brick es recortado mediante un Crop con el archivo de área de estudio correspondiente a la escena satelital. Este proceso se repite para cada una de las imágenes satelitales multiespectrales.</p>
</section>
<section id="reflectancia" class="level4" data-number="3.3.2.2">
<h4 data-number="3.3.2.2" class="anchored" data-anchor-id="reflectancia"><span class="header-section-number">3.3.2.2</span> Reflectancia</h4>
<p>A partir de los datos satelitales descargados se busca obtener la reflectancia usando correcciones a los valores disponibles usando factores numéricos disponibles en la metadata de la serie de datos del satélite en cuestión. Estos se aplican para los datos del satélite Landsat y OLI.</p>
<p>La expresión utilizada para transformar a radiancia los valores digitales (DN) de las bandas térmicas de Landsat 8 fue:</p>
<p><span class="math display">\[
L_\lambda = M_L \times Q_{cal} + A_L
\]</span></p>
<p>Donde:</p>
<ul>
<li><p><span class="math inline">\(L_\lambda\)</span> es la Radiancia espectral resultante (TOA)</p></li>
<li><p><span class="math inline">\(M_L\)</span> es un factor de rescalamiento multiplicativo de radiancia (metadata)</p></li>
<li><p><span class="math inline">\(A_L\)</span> es un factor de rescalamiento aditivido de radiancia (metadata)</p></li>
<li><p><span class="math inline">\(Q_{cal}\)</span> Valor calibrado del pixel (DN, o numero digital)</p></li>
</ul>
<p>Por otro lado, los valores espectrales de las bandas del sensor OLI, pueden transformarse a reflectancia usando la expresión:</p>
<p><span class="math display">\[
\rho _{\lambda} = \frac{M_\rho Q_{cal} + A_\rho}{sin(\theta_e)}
\]</span> Donde:</p>
<ul>
<li><p><span class="math inline">\(\rho _{\lambda}\)</span> es la reflectancia resultante (TOA)</p></li>
<li><p><span class="math inline">\(M_\rho\)</span> : es un factor de rescalamiento multiplicativo de radiancia (metadata)</p></li>
<li><p><span class="math inline">\(A_\rho\)</span>: es el factor de reescalamiento Aditivo (metadata)</p></li>
<li><p><span class="math inline">\(\theta_e\)</span> : ángulo de elevación solar (en grados) (metadata)</p></li>
</ul>
</section>
<section id="corrección-topográfica" class="level4" data-number="3.3.2.3">
<h4 data-number="3.3.2.3" class="anchored" data-anchor-id="corrección-topográfica"><span class="header-section-number">3.3.2.3</span> Corrección Topográfica</h4>
<p>Consiste en encontrar el ángulo de incidencia de los rayos solares en la superficie. Esta corrección se obtiene a través de un modelo de iluminación presente en <span class="citation" data-cites="colby1991topographic">(<a href="references.html#ref-colby1991topographic" role="doc-biblioref">Colby 1991</a>)</span>. Se utilizan los valores del azimut y la elevación solar, junto con los valores de la pendiente del terreno y su orientación, ambos obtenidos a través del procesamiento del MDE ASTER.</p>
<p><span class="math display">\[
cos(i) = cos(\theta_s)\cdot cos(\theta_n)+sin(\theta_s)\cdot sin(\theta_n)\cdot cos(\phi_s - \phi_n)
\]</span></p>
<p>Donde:</p>
<ul>
<li><p><span class="math inline">\(cos(i)\)</span>: coseno ángulo de incidencia</p></li>
<li><p><span class="math inline">\(\theta_s\)</span>: ángulo cenital solar</p></li>
<li><p><span class="math inline">\(\theta_n\)</span>: Pendiente de la superficie</p></li>
<li><p><span class="math inline">\(\phi_s\)</span>: azimut solar</p></li>
<li><p><span class="math inline">\(\phi_n\)</span>: orientación de la superficie</p></li>
</ul>
<p>Considerando en la expresión anterior que la pendiente de la superficie es nula (superficie de referencia), entonces es posible aplicar el algoritmo de corrección topográfica <span class="math inline">\(C\)</span>, propuesto por <span class="citation" data-cites="teilletSlopeAspectCorrectionMultispectral1982">(<a href="references.html#ref-teilletSlopeAspectCorrectionMultispectral1982" role="doc-biblioref">Teillet, Guindon, and Goodenough 1982</a>)</span> a través de la expresión:</p>
<p><span class="math display">\[
L_{\lambda Corr} = L_\lambda \left[\frac{Cos(v)+C}{Cos(i)+C}\right]
\]</span></p>
<p>Con:</p>
<ul>
<li><p><span class="math inline">\(L_{\lambda corr}\)</span>: Reflectancia Corregida</p></li>
<li><p><span class="math inline">\(Cos(v)\)</span>: Coseno para una superficie horizontal</p></li>
<li><p><span class="math inline">\(C=\frac{b}{m}\)</span> obetenido de la regresión <span class="math inline">\(L_\lambda=b+m\cdot cos(i)\)</span> usado minimos cuadrados entre la reflectancia de cada banda espectral y el modelo de iluminación.</p></li>
</ul>
</section>
</section>
<section id="cálculo-de-indices" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="cálculo-de-indices"><span class="header-section-number">3.3.3</span> Cálculo de Indices</h3>
<section id="tst" class="level4" data-number="3.3.3.1">
<h4 data-number="3.3.3.1" class="anchored" data-anchor-id="tst"><span class="header-section-number">3.3.3.1</span> TST</h4>
<p>La Temperatura Superficial Terrestre (TST) corresponde a una variable física que permite obtener datos de temperatura en grados Celsius a partir del procesamiento de las imágenes satelitales. En este caso, se utilizaron las imágenes satelitales mencionadas anteriormente para determinar las TST en las temporadas frías y cálidas del año (invierno y verano), las cuales luego son integradas para calcular la Amplitud Térmica Anual (ATA).</p>
<p>Para estimar la temperatura superficial terrestre (TST) se utilizó el algoritmo monocanal o single channel (SC), propuesto por <span class="citation" data-cites="jimenez-munozGeneralizedSinglechannelMethod2003">(<a href="references.html#ref-jimenez-munozGeneralizedSinglechannelMethod2003" role="doc-biblioref">Jim’enez-Muñoz and Sobrino 2003</a>)</span>. Este método fue escogido debido a su flexibilidad en términos de las diversas condiciones atmosféricas y a su adaptabilidad a distintos tipos de sensores con bandas espectrales en la ventana atmosférica que se encuentra entre las longitudes de onda de 10 – 12 mm. Para la estimación de la TST se necesitó de cinco magnitudes fundamentales:</p>
<ul>
<li><p>La radiancia de la banda termal</p></li>
<li><p>La temperatura de brillo en el sensor</p></li>
<li><p>La emisividad de la superficie</p></li>
<li><p>El contenido de vapor de agua en la atmósfera</p></li>
<li><p>Los centros de los rangos espectrales asociados a las longitudes de onda de las bandas térmicas consideradas</p></li>
</ul>
<p>Cuatro de estas magnitudes se obtuvieron a través del procesamiento directo de las bandas espectrales de cada imagen Landsat, mientras que el vapor de agua provino del sensor MODIS. La radiancia espectral de las bandas termales se obtuvo en la etapa de corrección de los insumos espaciales. Por su parte, los parámetros y el algoritmo para obtener la temperatura de brillo en el sensor (T_B) se obtuvieron del Programa Landsat (2002) y el sitio web de la <a href="https://www.usgs.gov/">USGS</a>.</p>
<p>A su vez, la emisividad de la superficie (<span class="math inline">\(\epsilon_{sc}\)</span>) utilizada en el método monocanal, se estimó considerando el conocimiento a priori de la emisividad de algunas superficies y su relación estadística con algunos valores umbrales del logaritmo natural del NDVI. Para calcular la emisividad se usaron los valores umbrales del índice vegetacional, rangos propuestos por <span class="citation" data-cites="vandegriendRelationshipThermalEmissivity1993">(<a href="references.html#ref-vandegriendRelationshipThermalEmissivity1993" role="doc-biblioref">VAN DE GRIEND and OWE 1993</a>)</span>.</p>
<p>La TST se obtuvo directamente en grados Celsius, utilizando el método monocanal de Jiménez (2003 y 2014). Las funciones de transferencia atmosférica <span class="math inline">\(\psi_1\)</span>, <span class="math inline">\(\psi_2\)</span>, <span class="math inline">\(\psi_3\)</span> , fueron obtenidas como función del vapor de agua atmosférico (w), según las expresiones y parámetros considerados para la banda 11:</p>
<p><span class="math display">\[
\psi_1 = 0.04019w^2 - 0.02916w + 1.01523
\]</span></p>
<p><span class="math display">\[
\psi_2 = -0.38333w^2 - 1.50294w + 0.20324
\]</span></p>
<p><span class="math display">\[
\psi_3 = 0.00918w^2 - 1.36072w - 0.27514
\]</span></p>
<p>Para estimar la TST se integraron todos los parámetros generados en el algoritmo monocanal (SC) generalizado de <span class="citation" data-cites="jimenez-munozGeneralizedSinglechannelMethod2003">(<a href="references.html#ref-jimenez-munozGeneralizedSinglechannelMethod2003" role="doc-biblioref">Jim’enez-Muñoz and Sobrino 2003</a>)</span>:</p>
<p><span class="math display">\[
TST_{sc}=\gamma\left[ \epsilon^{-1} \left( \psi_1L_{\lambda corr
} + \psi_2\right) + \psi_3 \right] + \delta - 273,15
\]</span></p>
<p>Con las siguienest aproximaciones de los parámetros gamma (<span class="math inline">\(\gamma\)</span>) y delta (<span class="math inline">\(\delta\)</span>):</p>
<p><span class="math display">\[
\gamma = \left\{ \frac{c_2L{\lambda corr}}{T^2_{B10}} \left[ \frac{\lambda^4}{c_1} L_{\lambda corr} +\lambda^{-1}\right] \right\}^{-1}
\]</span></p>
<p>Donde:</p>
<ul>
<li><p><span class="math inline">\(L_{\lambda corr}\)</span> es la Radiancia espectral corregida topográficamente de la banda 11.</p></li>
<li><p><span class="math inline">\(T_{B10}\)</span> es la temperatura de brillo banda 11 (°K)</p></li>
<li><p><span class="math inline">\(\lambda\)</span> es el centro del rango de longitud de onda de la banda 11.</p></li>
</ul>
<p>Tanto las TST de verano como las de invierno se obtienen en formato raster con resolución de 30 por 30 metros. Luego se procedió a obtener un compuesto para verano y otro para invierno. Finalmente, ambos compuestos se integran en uno solo que considera la diferencia entre la TST de verano y de invierno, el que se denomina Amplitud Térmica Anual (ATA).</p>
</section>
<section id="ata" class="level4" data-number="3.3.3.2">
<h4 data-number="3.3.3.2" class="anchored" data-anchor-id="ata"><span class="header-section-number">3.3.3.2</span> ATA</h4>
<p>La Amplitud Térmica Anual (ATA) corresponde a una imagen raster que contiene los valores producto de la diferencia entre las temperaturas superficiales de verano y de invierno. Representa las diferencias de temperatura entre ambas temporadas, y es el insumo principal para el cálculo del Indicador de Amplitud Térmica Anual (IATA). Mientras los valores de ATA sean más altos, representan una mayor diferencia entre las temperaturas de invierno y verano en una misma área. Por el contrario, si los valores de ATA son bajos, significa que la diferencia entre los valores de temperatura de invierno y verano es menor en una misma área, o que los valores son muy similares entre sí.</p>
</section>
<section id="ndvi" class="level4" data-number="3.3.3.3">
<h4 data-number="3.3.3.3" class="anchored" data-anchor-id="ndvi"><span class="header-section-number">3.3.3.3</span> NDVI</h4>
<p>El NDVI (Normalized Difference Vegetation Index), índice espectral que permite identificar áreas vegetadas a partir de la definición de un valor umbral mínimo según <span class="citation" data-cites="myneni1995interpretation">(<a href="references.html#ref-myneni1995interpretation" role="doc-biblioref">Myneni et al. 1995</a>)</span>. El NDVI trabaja con las bandas del infrarrojo y del rojo, dado que son las bandas donde más y menos reflejan la vegetación, respectivamente. Este fue obtenido mediante la expresión:</p>
<p><span class="math display">\[
NDVI = \frac{NIR-RED}{NIR-RED}
\]</span></p>
<p>Los valores de este índice se encuentran en el rango de -1 a 1, y usualmente se considera que los valores mayores o iguales a 0,2 corresponden a vegetación. Para determinar un valor umbral mínimo de vegetación tanto para invierno como para verano, se van testeando valores umbrales desde 0,2 hacia arriba, sumando cada vez 0,05 al umbral inicial, hasta llegar a visualizar una cobertura vegetal que corresponda con la vegetación visible en un basemap de alta resolución y a la composición de bandas en color verdadero de la imagen satelital que dio origen al NDVI. A partir de estos valores umbrales se obtienen dos coberturas de vegetación, una de invierno y otra de verano, las cuales se integran en una sola cobertura anual de vegetación, sumando espacialmente los píxeles considerados como vegetación. Esta cobertura vegetal posteriormente será integrada a las coberturas vectoriales para calcular el Indicador de Cobertura Vegetal (ICV).</p>
</section>
</section>
<section id="cálculo-de-indicadores" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="cálculo-de-indicadores"><span class="header-section-number">3.3.4</span> Cálculo de Indicadores</h3>
<section id="icv" class="level4" data-number="3.3.4.1">
<h4 data-number="3.3.4.1" class="anchored" data-anchor-id="icv"><span class="header-section-number">3.3.4.1</span> ICV</h4>
<p><img src="img/diagrama-ambiental-icv.PNG" class="img-fluid"></p>
<p>Para espacializar estos resultados, fueron considerados los polígonos de las manzanas para las áreas urbanas y los de las entidades rurales para las áreas rurales. El procedimiento para atributar de valores cada uno de los polígonos que componen las coberturas consistió en calcular la superficie cubierta por vegetación en cada polígono, y luego comparando esa superficie con respecto a la superficie total del polígono. Por esto, el resultado del indicador se expresa en valores de 0 a 100, lo que representa el porcentaje de superficie cubierto de vegetación de cada polígono. Este indicador permite que cada polígono cuente con una expresión porcentual de su superficie cubierta con vegetación. Mientras mayor sea este valor, representa que un mayor porcentaje de la superficie se encuentra cubierta por vegetación, incluso considerando la totalidad del polígono (100%). Por el contrario, es posible que algunos polígonos tengan valores 0, correspondientes a aquellas áreas que no poseen cobertura vegetal.</p>
</section>
<section id="iata" class="level4" data-number="3.3.4.2">
<h4 data-number="3.3.4.2" class="anchored" data-anchor-id="iata"><span class="header-section-number">3.3.4.2</span> IATA</h4>
<p><img src="img/diagrama-ambiental-iata.PNG" class="img-fluid"></p>
<p>El Indicador de Amplitud Térmica Anual (IATA) se refiere a la diferencia entre la Temperatura Superficial Terrestre (TST) máxima y mínima dentro de un año. La TST máxima corresponde a la época de verano, mientras que la TST mínima corresponde al invierno, y se calcula tal como se aprecia en la siguiente fórmula.</p>
<p><span class="math display">\[
IATA = TST_{ver} - TST_{inv}
\]</span></p>
<p>La ATA sale procesada en formato raster, con la misma resolución de las TST. La información del formato raster se traspasa finalmente a los polígonos de manzanas en el caso de las áreas urbanas y las entidades en el caso de las áreas rurales. Este indicador permite que cada polígono cuente con una temperatura expresada en grados Celsius, el que representa la amplitud térmica entre el invierno y el verano. Mientras mayor sea este valor, representa que la diferencia de temperaturas entre el verano y el invierno es significativa. Mientras que, si el valor es menor, implica una diferencia térmica marginal entre el verano y el invierno. Puntualmente, puede ocurrir que algunos polígonos obtengan una amplitud térmica negativa, lo que implica que, en ese sector las temperaturas de invierno fueron localmente mayores a las obtenidas en verano.</p>
</section>
</section>
</section>
<section id="aplicación" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="aplicación"><span class="header-section-number">3.4</span> Aplicación</h2>
<section id="icv-1" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="icv-1"><span class="header-section-number">3.4.1</span> ICV</h3>
<p>Para ilustrar estos procesos se calcularán los indicadores ambientales para la comuna de Las Condes. Para esto comenzamos por configurar el entorno de trabajo cargando las librerías necesarias para el proceso y definiendo ciertos parámetros claves como los sistemas de proyección de coordenadas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exactextractr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>crs_latlon <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs"</span><span class="co"># geográficas o elipsoidales</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>crs_utm <span class="ot">&lt;-</span> <span class="st">"+proj=utm +zone=19 +south +datum=WGS84 +units=m +no_defs"</span> <span class="co"># UTM o cartográficas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con esto cargamos los datos necesarios para el proceso, la información satelital contenida en un archivo <code>.tif</code> y las manzanas de la comuna de las Condes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>OLI <span class="ot">&lt;-</span> <span class="fu">brick</span>(<span class="st">"data/corte_rm_m.tif"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mzs <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/manzanas_lc.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Realizamos un preproceso inicial, rescatando el contorno de la comuna, asignando información de nombres al archivo de información satelital y generando un recorte del area de estudio comunal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nombre bandas</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(OLI) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"aerosol"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>, <span class="st">"nir"</span>, <span class="st">"swir1"</span>, <span class="st">"swir2"</span>, <span class="st">"thermal"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># contorno comunal</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>comuna <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mzs) <span class="sc">%&gt;%</span> <span class="fu">st_buffer</span>(<span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> <span class="fu">st_buffer</span>(<span class="sc">-</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">as_Spatial</span>()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># recorte</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>comuna_img <span class="ot">&lt;-</span> <span class="fu">mask</span>(<span class="fu">crop</span>(OLI, <span class="fu">extent</span>(comuna), <span class="at">snap=</span><span class="st">"out"</span>), comuna)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># latlon a utm</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>comuna_img <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(comuna_img, <span class="at">crs =</span> crs_utm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con esto podemos visualizar la información satelital de la comuna:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotRGB</span>(comuna_img, <span class="at">r =</span> <span class="dv">4</span>, <span class="at">g =</span> <span class="dv">3</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">stretch =</span> <span class="st">"lin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ambiental_files/figure-html/amb-viz-LC-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A partir de esto podemos calcular los índices que son la base de los indicadores: NDVI</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>NDVI <span class="ot">&lt;-</span> <span class="cf">function</span>(img, i, k) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>   bi <span class="ot">&lt;-</span> img[[i]]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>   bk <span class="ot">&lt;-</span> img[[k]]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>   vi <span class="ot">&lt;-</span> (bk <span class="sc">-</span> bi) <span class="sc">/</span> (bk <span class="sc">+</span> bi)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(vi)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>NDVI_com <span class="ot">&lt;-</span> <span class="fu">NDVI</span>(comuna_img, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>NDVI_com_df <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">as.data.frame</span>(NDVI_com, <span class="at">xy =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Este resultado puede visualizarse para revisar su pertinencia:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pal_ndvi<span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"gray20"</span>, <span class="st">"yellow"</span>, <span class="st">"green"</span>,<span class="st">"springgreen4"</span>))( <span class="dv">200</span> )</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> NDVI_com_df , </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> layer)) <span class="sc">+</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">name =</span> <span class="st">"NDVI"</span>, <span class="at">colors =</span> pal_ndvi)<span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()<span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"NDVI de Las Condes"</span>) ) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>,<span class="at">y=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray80"</span>), </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray80"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ambiental_files/figure-html/amb-viz-ndvi-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ahora es necesario definir un umbral a partir del cual se considera un pixel como cubierto de vegetación. Para esto examinamos la distribución empírica de los valores del índice normalizado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(NDVI_com, <span class="at">col=</span><span class="st">"springgreen4"</span>, <span class="at">main=</span><span class="st">"Histograma NDVI"</span>, <span class="at">ylab=</span><span class="st">"Número de Pixeles"</span>, <span class="at">xlab=</span><span class="st">"valor NDVI"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ambiental_files/figure-html/amb-hist-ndvi-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Con esto podemos definir el umbral de corte en 0.3, lo que permite descartar vegetación no frondoza en el territorio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#función para definir umbral</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>corte_eq_may <span class="ot">&lt;-</span> <span class="cf">function</span>(value) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(x <span class="sc">&gt;=</span> value, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>vegetacion <span class="ot">&lt;-</span> <span class="fu">calc</span>(NDVI_com, <span class="at">fun =</span> <span class="fu">corte_eq_may</span>(<span class="at">value =</span> <span class="fl">0.30</span>))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>vegetacion_df <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">as.data.frame</span>(vegetacion, <span class="at">xy =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El resultado de este corte puede revisarse gráficamente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(comuna), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span><span class="st">"orange"</span>, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.8</span>,  <span class="at">size=</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> vegetacion_df , </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> layer)) <span class="sc">+</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">name =</span> <span class="st">"Veg"</span>, <span class="at">colors =</span> <span class="st">"springgreen4"</span>)<span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Vegetación Las Condes"</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span><span class="st">""</span>)<span class="sc">+</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray80"</span>), </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray80"</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ambiental_files/figure-html/amb-viz-veg-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A partir de esto es posible contar los pixeles dentro de cada manzana que están cubiertos por vegetación, y así calcular el indicador de Cobertura Vegetal (ICV):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mz_comuna  <span class="ot">&lt;-</span> mzs <span class="sc">%&gt;%</span> <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AREA=</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pix_veg =</span> <span class="fu">exact_extract</span>(vegetacion,<span class="at">y =</span> ., <span class="st">'sum'</span>, <span class="at">progress =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_veg =</span> pix_veg <span class="sc">*</span> <span class="dv">30</span> <span class="sc">*</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span> <span class="co"># resolución espacial landsat (30*30)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ICV =</span> <span class="fu">round</span>((area_veg <span class="sc">/</span>AREA)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con esto podemos visualizar el resultado del indicador ICV:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mz_comuna, <span class="fu">aes</span>(<span class="at">fill =</span> ICV), <span class="at">color =</span><span class="st">"gray70"</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.8</span>,  <span class="at">size=</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette=</span> <span class="st">"Greens"</span>, <span class="at">direction =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Indicador de Cobertura Vegetal (ICV) - Urbano"</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray80"</span>), </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray80"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ambiental_files/figure-html/amb-viz-res-icv-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="iata-1" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="iata-1"><span class="header-section-number">3.4.2</span> IATA</h3>
<p>Para ilustrar el proceso de trabajo de el indicador de amplitud térmica comenzamos por cargar las imágenes raster con la información de temperatura superficial para invierno y verano:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tst_inv <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">"data/tst_inv_R13.tif"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>tst_ver <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">"data/tst_ver_R13.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Luego preprocesamos estos datos, generando recortes comunales de la información a trabajar:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># contorno manzanas</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>comuna <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mzs) <span class="sc">%&gt;%</span> <span class="fu">st_buffer</span>(<span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> <span class="fu">st_buffer</span>(<span class="sc">-</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">as_Spatial</span>()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># contonro invierno y verano (respetar crs)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>comuna_inv <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(<span class="fu">st_as_sf</span>(comuna), <span class="at">crs =</span> <span class="fu">crs</span>(tst_inv))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>comuna_ver <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(<span class="fu">st_as_sf</span>(comuna), <span class="at">crs =</span> <span class="fu">crs</span>(tst_ver))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># recorte</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>comuna_inv <span class="ot">&lt;-</span> <span class="fu">mask</span>(<span class="fu">crop</span>(tst_inv, <span class="fu">extent</span>(comuna_inv), <span class="at">snap=</span><span class="st">"out"</span>), comuna_inv)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>comuna_ver <span class="ot">&lt;-</span> <span class="fu">mask</span>(<span class="fu">crop</span>(tst_ver, <span class="fu">extent</span>(comuna_ver), <span class="at">snap=</span><span class="st">"out"</span>), comuna_ver)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># reproyectar a utm</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>comuna_inv <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(comuna_inv, <span class="at">crs =</span> crs_utm)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>comuna_ver <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(comuna_ver, <span class="at">crs =</span> crs_utm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con esto podemos calcular la diferencia de temperaturas entre invierno y verano:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>comuna_ver <span class="ot">&lt;-</span> <span class="fu">resample</span>(comuna_ver,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">raster</span>(<span class="fu">extent</span>(comuna_inv),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">nrow =</span> <span class="fu">nrow</span>(comuna_inv),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ncol =</span> <span class="fu">ncol</span>(comuna_inv),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">crs =</span> crs_utm))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>amplitud <span class="ot">&lt;-</span> <span class="fu">overlay</span>(comuna_inv, comuna_ver,  <span class="at">fun =</span> <span class="cf">function</span>(x, y) {y <span class="sc">-</span> x})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># viz amplitud</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(amplitud, <span class="at">main =</span> <span class="st">"Diferencia Temperatura Las Condes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ambiental_files/figure-html/amb-viz-diftemp-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Y luego asignar el promedio de diferencias a las manzanas correspondientes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mz_comuna  <span class="ot">&lt;-</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  mzs <span class="sc">%&gt;%</span> <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(crs_utm) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">IATA =</span> <span class="fu">exact_extract</span>(amplitud, mzs, <span class="st">'mean'</span>, <span class="at">progress =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mz_comuna) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="st">"IATA"</span>, <span class="at">style =</span> <span class="st">"jenks"</span>) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">"Indicador de Amplitud Térmica"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ambiental_files/figure-html/amb-viz-iata-1.png" class="img-fluid" width="672"></p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-colby1991topographic" class="csl-entry" role="listitem">
Colby, Jeffrey D. 1991. <span>“Topographic Normalization in Rugged Terrain.”</span> <em>Photogrammetric Engineering and Remote Sensing</em> 57 (5): 531–37.
</div>
<div id="ref-jimenez-munozGeneralizedSinglechannelMethod2003" class="csl-entry" role="listitem">
Jim’enez-Muñoz, Juan C., and Jos’e A. Sobrino. 2003. <span>“A Generalized Single-Channel Method for Retrieving Land Surface Temperature from Remote Sensing Data.”</span> <em>Journal of Geophysical Research: Atmospheres</em> 108 (D22). <a href="https://doi.org/10.1029/2003JD003480">https://doi.org/10.1029/2003JD003480</a>.
</div>
<div id="ref-myneni1995interpretation" class="csl-entry" role="listitem">
Myneni, Ranga B, Forrest G Hall, Piers J Sellers, and Alexander L Marshak. 1995. <span>“The Interpretation of Spectral Vegetation Indexes.”</span> <em>IEEE Transactions on Geoscience and Remote Sensing</em> 33 (2): 481–86.
</div>
<div id="ref-teilletSlopeAspectCorrectionMultispectral1982" class="csl-entry" role="listitem">
Teillet, P. M., B. Guindon, and D. G. Goodenough. 1982. <span>“On the <span>Slope-Aspect Correction</span> of <span>Multispectral Scanner Data</span>.”</span> <em>Canadian Journal of Remote Sensing</em> 8 (2): 84–106. <a href="https://doi.org/10.1080/07038992.1982.10855028">https://doi.org/10.1080/07038992.1982.10855028</a>.
</div>
<div id="ref-vandegriendRelationshipThermalEmissivity1993" class="csl-entry" role="listitem">
VAN DE GRIEND, A. A., and M. OWE. 1993. <span>“On the Relationship Between Thermal Emissivity and the Normalized Difference Vegetation Index for Natural Surfaces.”</span> <em>International Journal of Remote Sensing</em> 14 (6): 1119–31. <a href="https://doi.org/10.1080/01431169308904400">https://doi.org/10.1080/01431169308904400</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./socioeconomico.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Dimensión Socioeconómica</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./seguridad.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dimensión Seguridad</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>